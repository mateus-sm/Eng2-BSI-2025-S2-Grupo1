<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Atribuir Pagamento de Mensalidade</title>
    <link rel="shortcut icon" type="image/png" th:href="@{/images/BrasãoDemolay.png}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/styles/membros.css}" href="/styles/membros.css">
</head>

<body>
<div class="container">

    <div class="page-header text-center mt-4 mb-4">
        <img src="/mnt/data/ec49cfa7-3393-4e19-b7f4-dbe417f5859d.png"
             th:src="@{/images/BrasãoDemolay.png}"
             alt="Logo DM Info"
             class="logo-img">
        <h2>Atribuir Pagamento de Mensalidade</h2>
    </div>

    <div class="row mb-4 align-items-center justify-content-center">
        <div class="col-12 col-md-10">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">Registrar Pagamento</h5>
                </div>
                <div class="card-body">

                    <form id="formMensalidade" class="needs-validation" novalidate onsubmit="salvarMensalidade(event)">

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="selectMembro" class="form-label asterisco">Membro:</label>
                                <select id="selectMembro" class="form-control form-select" required>
                                    <option value="">-- Selecione um membro --</option>
                                </select>
                                <div class="invalid-feedback">Selecione um membro.</div>
                            </div>

                            <div class="col-md-3">
                                <label for="selectMes" class="form-label asterisco">Mês:</label>
                                <select id="selectMes" class="form-control form-select" required>
                                    <option value="">-- Mês --</option>
                                </select>
                                <div class="invalid-feedback">Selecione o mês.</div>
                            </div>

                            <div class="col-md-3">
                                <label for="selectAno" class="form-label asterisco">Ano:</label>
                                <select id="selectAno" class="form-control form-select" required>
                                    <option value="">-- Ano --</option>
                                </select>
                                <div class="invalid-feedback">Selecione o ano.</div>
                            </div>
                        </div>

                        <div class="row g-3 mt-2">
                            <div class="col-md-6">
                                <label for="valor" class="form-label asterisco">Valor (R$):</label>
                                <input type="number" step="0.01" id="valor" class="form-control" required placeholder="Ex: 30.00">
                                <div class="invalid-feedback">Digite um valor válido.</div>
                            </div>

                            <div class="col-md-6">
                                <label for="dataPagamento" class="form-label asterisco">Data do Pagamento:</label>
                                <input type="date" id="dataPagamento" class="form-control" required>
                                <div class="invalid-feedback">Informe a data de pagamento.</div>
                            </div>
                        </div>

                        <div class="row g-3 mt-3">
                            <div class="col-md-12 d-grid">
                                <button type="submit" class="btn btn-primary" id="btnSalvar">Salvar Pagamento</button>
                                <input type="hidden" id="idMensalidade">
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="alertaContainer" class="mb-3"></div>

    <div class="row mb-4 align-items-center justify-content-center">
        <div class="col-12 col-md-8 mb-3 mb-md-0">
            <input type="text" id="filtro" class="form-control text-center" placeholder="Buscar por nome do membro...">
        </div>
        <div class="col-12 col-md-auto">
            <button id="btnFiltrar" class="btn btn-primary" onclick="carregarMensalidades(document.getElementById('filtro').value)">Filtrar</button>
        </div>
    </div>

    <p class="text-center text-muted">
        Total de mensalidades: <span id="totalMensalidades">0</span>
    </p>

    <div class="table-responsive table-container">
        <table class="table table-hover align-middle">
            <thead>
            <tr>
                <th class="text-center" style="width:60px;">ID</th>
                <th>Membro</th>
                <th>Mês</th>
                <th>Ano</th>
                <th>Valor</th>
                <th>Data</th>
                <th class="text-center" style="width:120px;">Ações</th>
            </tr>
            </thead>
            <tbody id="tabelaMensalidades">
            </tbody>
        </table>

        <div id="mensagemVazia" class="text-center py-5 text-muted d-none">
            <p>Nenhum pagamento encontrado.</p>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/mensalidade.js}" src="/js/mensalidade.js"></script>
</body>
</html>
